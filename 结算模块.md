#结算模块

[TOC]

### 业务描述
结算中心主要是对平台每笔订单金额的收入与支出进行追踪并生成对应的账务记录，汇总记录及付款建议等，便于财务人员对商家进行打款和运营人员直观的了解整个平台的盈利情况。


###结算中心依赖的其他模块
+ 支付模块：提供第三方账务数据，用于对账。
+ 用户模块：商家提供账期、费率等信息
   账期：运营输入 1、5、10、15、30五类（可以灵活配置）
   费率：三个地方可以设置 1、shopExtra 2、行业 3、二级类目（可扩展到商品级  别）
+ 交易模块：订单相关信息


###整体流程图
![描述](http://7u2myi.com1.z0.glb.clouddn.com/结算模块整体流程图.png)
####说明
订单支付成功5分钟后会生成对应的账务记录,此时的账务数据只有基本的数据，例如优惠券信息，支付金额等。接下来就是要逐步回填相应地数据以及状态流转，例如待订单完成、待对账、待回填平台佣金、最后是完成。完成后的订单就可以参与汇总和生成付款建议了。

###列表清单
* 账务明细列表
* 账务记录列表
* 商家日汇总列表
* 平台日汇总列表
* 付款建议列表
* 支付渠道日汇总明细列表
* 支付渠道日汇总列表
* 平台优惠券日汇总列表
* 保证金列表
* 技术服务费列表
* 奖惩明细列表

####业务逻辑及流程图
* 账务记录列表
**类名：**Settlement
**表名：**parana_settlements
**业务解释：**记录每笔线上支付订单的交易金额，与订单是一对一的关系，订单支付成功后即可生成结算，由结算模块的增量和全量job主动拉取orderTrack表中已支付的订单，待结算生成后，需要回填平台佣金，第三方手续费，对账等数据的回填，通过状态位来一一表示，状态位有WAIT_ORDER_FINISH(1,"待订单完成"), WAIT_CHECK(2, "待对账"),WAIT_INSERT_COMMISSON(3,"待回填平台佣金"),DONE(4,"完成"); 只有完成的订单才可以参与汇总，例如商家日汇总、平台日汇总、付款建议等。
**流程图**
![描述](http://7u2myi.com1.z0.glb.clouddn.com/结算模块整体流程图.png)
**商家中心**
![描述](http://7u2myi.com1.z0.glb.clouddn.com/商家中心账务记录.gif)

**运营后台**
